@BITE_THE_DUST_CLEAR_LEGECY
#DIM 번호대피소
#DIM CHARANUM대피소
VARSET JUEL
VARSET MOBGIRL_PLACE, 99
CALL BITE_THE_DUST_CLEAR_FLAG
;대본 리셋
FOR LOCAL,101, 110
	SIF ITEM:LOCAL != 2
		ITEM:LOCAL = 0
NEXT
CFLAG:MASTER:초대 = 0
CFLAG:MASTER:육아인원수 = 0
CFLAG:MASTER:아이인원수 = 0
;당신의 기정사실 및[연인]을 클리어
CLEARBIT CFLAG:MASTER:기정사실, 2
TALENT:MASTER:연인 = 0
;당신 이외 전원 리셋.
;여기서 CHARANUM의 값이 바뀌므로 주의
TARGET = 0
ASSI = 0
VARSET MOBGIRL_PLACE, 99
VARSET 인계대상정보
VARSET 인계대상TALENT
VARSET 인계대상CFLAG
VARSET 인계대상CFLAG1
VARSET 인계대상CFLAG2
VARSET 인계CSTR
;PICKUPCHARA MASTER
CHARANUM대피소 = CHARANUM
FOR LOCAL,1,CHARANUM대피소
	IF LOCAL > CHARANUM대피소
		BREAK
	ENDIF
	PRINTFORML 현재대상 : %CALLNAME:(CHARANUM대피소 - LOCAL)%, 번호로는 {CHARANUM대피소 - LOCAL}번 캐릭터
	IF CHARANUM대피소 - LOCAL == MASTER
		PRINTFORML WARNING!WARNING!WARNING!%마스터를% 죽이려 한다!WARNING!WARNING!WARNING!
		WAIT
		BREAK
	ENDIF
	IF 인계대상:(CHARANUM대피소 - LOCAL) == 1
		PRINTFORM %CALLNAME:(CHARANUM대피소 - LOCAL)%은 생존했다
		FOR LOCAL:1,0,100
			인계대상정보:(CHARANUM대피소 - LOCAL):0:(LOCAL:1) = ABL:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,3333
			인계대상CFLAG:(CHARANUM대피소 - LOCAL):(LOCAL:1) = CFLAG:(CHARANUM대피소 - LOCAL):(LOCAL:1)
			인계대상CFLAG1:(CHARANUM대피소 - LOCAL):(LOCAL:1) = CFLAG:(CHARANUM대피소 - LOCAL):(LOCAL:1 + 3333)
			인계대상CFLAG2:(CHARANUM대피소 - LOCAL):(LOCAL:1) = CFLAG:(CHARANUM대피소 - LOCAL):(LOCAL:1 + 6666)
		NEXT
		FOR LOCAL:1,0,51
			인계CSTR:(CHARANUM대피소 - LOCAL):(LOCAL:1) = %CSTR:(CHARANUM대피소 - LOCAL):(LOCAL:1)%
		NEXT
		FOR LOCAL:1,0,100
			인계대상정보:(CHARANUM대피소 - LOCAL):1:(LOCAL:1) = BASE:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,200
			인계대상정보:(CHARANUM대피소 - LOCAL):2:(LOCAL:1) = EXP:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,100
			인계대상정보:(CHARANUM대피소 - LOCAL):3:(LOCAL:1) = MARK:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,2500
			인계대상TALENT:(CHARANUM대피소 - LOCAL):(LOCAL:1) = TALENT:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,1000
			인계대상정보:(CHARANUM대피소 - LOCAL):4:(LOCAL:1) = TCVAR:(CHARANUM대피소 - LOCAL):(LOCAL:1)
		NEXT
	ELSE
		PRINTFORM %CALLNAME:(CHARANUM대피소 - LOCAL)%은 폭발했다
	ENDIF
	번호대피소 = GETCHARA (CHARANUM대피소 - LOCAL)
	PRINTFORML  {번호대피소}번
	DELCHARA (번호대피소)
NEXT
DRAWLINE
FOR LOCAL,1,CHARANUM대피소
	PRINTFORML {LOCAL}번 캐릭터
	ADDCHARA LOCAL
	IF !IS_인계대상(LOCAL)
		PRINTFORML %CALLNAME:LOCAL%은 부활했다
	ELSE
		PRINTFORML %CALLNAME:LOCAL%은 이미 부활해 있다
	ENDIF
	IF 인계대상:LOCAL != 0
		FOR LOCAL:1,0,100
			ABL:LOCAL:(LOCAL:1) = 인계대상정보:LOCAL:0:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,3333
			CFLAG:LOCAL:(LOCAL:1) = 인계대상CFLAG:LOCAL:(LOCAL:1)
			CFLAG:LOCAL:(LOCAL:1+3333) = 인계대상CFLAG1:LOCAL:(LOCAL:1)
			CFLAG:LOCAL:(LOCAL:1+6666) = 인계대상CFLAG2:LOCAL:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,51
			CSTR:LOCAL:(LOCAL:1) = %인계CSTR:LOCAL:(LOCAL:1)%
		NEXT
		FOR LOCAL:1,0,100
			BASE:LOCAL:(LOCAL:1) = 인계대상정보:LOCAL:1:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,200
			EXP:LOCAL:(LOCAL:1) = 인계대상정보:LOCAL:2:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,100
			MARK:LOCAL:(LOCAL:1) = 인계대상정보:LOCAL:3:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,2500
			TALENT:LOCAL:(LOCAL:1) = 인계대상TALENT:LOCAL:(LOCAL:1)
		NEXT
		FOR LOCAL:1,0,1000
			TCVAR:LOCAL:(LOCAL:1) = 인계대상정보:LOCAL:4:(LOCAL:1)
		NEXT
		RESULT = 0
	ELSE
		TRYCALLFORM 개별스킬세팅{LOCAL}
		TRYCALLFORM 개별능력치세팅{LOCAL}
		TRYCALLFORM 개별내성세팅{LOCAL}
	ENDIF
	TRYCALLFORM M_KOJO_K{LOCAL}
	IF RESULT
		CFLAG:LOCAL:구상실장상황 = 1
	ELSE
		CFLAG:LOCAL:구상실장상황 = 0
	ENDIF
NEXT
SORTCHARA
VARSET JUEL
;당신リセット
PRINTFORML %CALLNAME:MASTER%의 경험·능력도 리셋하겠습니까?
CALL COLORMESSAGE(@"실적으로 취득한 소질 등도 취소되기 때문에 추천하지 않습니다", C_YELLOW,1)
CALL ASK_YN
IF !RESULT
	FOR LOCAL,0, 100
		ABL:MASTER:LOCAL = 0
		EXP:MASTER:LOCAL = 0
	NEXT
	FOR LOCAL,100, 150
		EXP:MASTER:LOCAL = 0
	NEXT
	PRINTFORMW 리셋 했습니다.
ENDIF


@IS_인계대상(ARG)
#FUNCTION
FOR LOCAL,0,500
	IF 인계대상:LOCAL == ARG
		RETURNF 1
	ENDIF
NEXT
RETURNF 0

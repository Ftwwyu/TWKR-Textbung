
@TSC_3
#DIM DYNAMIC 택시이동위치
#DIM 현재지점
#DIM 현재지MAPID
#DIM GOAL	 
CALL FIELDMAP
PRINTL
PRINTFORML 「어디로 모실까요 손님? 요금은 2000원입니다」
PRINTL
현재지MAPID = GET_MAPID(CFLAG:MASTER:현재위치)
PRINTFORM [ 0] - %"하쿠레이 신사", 18, LEFT%
IF 현재지MAPID == 0
	SETCOLOR 0 , 255, 0
	PRINTFORM 현위치\@ FLAG:70 ?  %"   "% # %" "% \@
	RESETCOLOR
ENDIF
PRINTL
;	// 여기까지 신사 표시
FOR LOCAL, 5001, 5011
	IF LOCAL == 현재지MAPID + 5000
		PRINTFORM [{현재지MAPID, 2, RIGHT}] - 
		PRINTFORM %NAME_FROM_PLACE(LOCAL), 21, LEFT%
		SETCOLOR 0 , 255, 0
		PRINTFORM 현위치\@ FLAG:70 ?  %"    "% # %"  "% \@
		RESETCOLOR
		SIF !(LOCAL % 2)
			PRINTL
		CONTINUE
	ENDIF
	PRINTFORM [{LOCAL - 5000, 2, RIGHT}] - 
	PRINTFORM %NAME_FROM_PLACE(LOCAL), 18, LEFT%
	SIF !(LOCAL % 2)
		PRINTL
NEXT
IF MAIN_MAP == 13
	PRINTFORM [13] - %"주택", 18, LEFT%
	IF 현재지MAPID == 13
		SETCOLOR 0 , 255, 0
		PRINTFORM 현위치\@ FLAG:70 ?  %"   "% # %" "% \@
		RESETCOLOR
	ENDIF
ENDIF
IF MAIN_MAP == 14
	PRINTFORM [14] - %"저택", 18, LEFT%
	IF 현재지MAPID == 14
		SETCOLOR 0 , 255, 0
		PRINTFORM 현위치\@ FLAG:70 ?  %"   "% # %" "% \@
		RESETCOLOR
	ENDIF
ENDIF
PRINTFORM [15] - %"매음굴", 18, LEFT%
IF 현재지MAPID == 15
	SETCOLOR 0 , 255, 0
	PRINTFORM 현위치\@ FLAG:70 ?  %"   "% # %" "% \@
	RESETCOLOR
ENDIF
PRINTL
PRINT [100] - 돌아간다
$LOOP
INPUT
;돌아간다
IF RESULT == 100
	RETURN -1
;시간정지발동
ELSEIF RESULT == 101

ELSEIF RESULT == 현재지MAPID
	;전체 맵으로부터도 이동할 수 있지만 더욱 시간 걸리는, 덤기능이므로
	LOCAL:1 = 1
	현재지점 = (CFLAG:MASTER:현재위치 - (CFLAG:MASTER:데이트중 * 100)) / 10
	FOR LOCAL,0,CHARANUM
		SIF CHK_DATENOW(CFLAG:LOCAL:데이트중) 
			CFLAG:LOCAL:현재위치 = (CFLAG:LOCAL:데이트중 * 100) + (LOCAL:1 * 10)
	NEXT
	TFLAG:데이트도중 = 0
	RETURN RESULT
ELSEIF RESULT == MAIN_MAP
	PRINTFORMW \@ CFLAG:MASTER:데이트중 != CFLAG:TARGET:데이트중 || TARGET == MASTER ?  외출 # 데이트 \@에서 돌아왔습니다
	CALL 모리야복권데이트상대의리셋()
	FOR LOCAL, 1, CHARANUM
		IF CHK_DATENOW(CFLAG:LOCAL:데이트중)
			CALL DATE_EVENT(LOCAL)
			CALL SET_DATE(99, LOCAL)
		ENDIF
	NEXT
	SIF CHK_DATENOW(CFLAG:MASTER:데이트중)
		CALL SET_DATE(99, MASTER)
	TFLAG:데이트도중 = 0
	CFLAG:MASTER:현재위치 = GET_ENTRANCE(MAIN_MAP)
	RETURN MAIN_MAP
ELSEIF RESULT != 12
	GOAL = RESULT
	;100분의 도중은 없습니다…
	IF RESULT == 15 && FLAG:데이트상대
		PRINTFORMW 데이트중에 갈 만한 곳은 아니다
		RETURN -1
	ENDIF
	IF RESULT == 13&&MAIN_MAP != 13
		GOTO LOOP
	ENDIF
	IF RESULT == 14&&MAIN_MAP != 14
		GOTO LOOP
	ENDIF
	TIME += 10
	MONEY -= 2000
	IF GET_MAPID(CFLAG:MASTER:현재위치) == MAIN_MAP
		LOCAL:1 = 0
		FOR LOCAL,1,CHARANUM
			SIF CFLAG:(LOCAL):동행
				LOCAL:1 ++
		NEXT
		IF LOCAL:1 == 1
			;100분의 도중은 없습니다…
			PRINTL 데이트를 하러 나갑니다
			FOR LOCAL,1,CHARANUM
				IF CFLAG:(LOCAL):동행
					CALL SET_DATE(GOAL,LOCAL)
					TFLAG:데이트도중 = 0
				ENDIF
			NEXT
		;같은 사람 데이트 처리(미설정)
		ELSEIF LOCAL:1 > 1
		;한사람
		ELSE	
			CALL SET_DATE(GOAL,0)
			TFLAG:데이트도중 = 0
			RETURN GOAL
		ENDIF
		RETURN GOAL
	ELSEIF FLAG:데이트상대 > 0
		PRINTFORML %GET_MAPNAME(GOAL)%로 갑니다
		CALL SET_DATE(GOAL,(FLAG:데이트상대))
		TFLAG:데이트도중 = 0
		RETURN GOAL
	ENDIF
	FOR LOCAL,0,CHARANUM
		IF CHK_DATENOW(CFLAG:LOCAL:데이트중)
			CFLAG:LOCAL:현재위치 = GET_ENTRANCE(GOAL)
			CFLAG:LOCAL:데이트중 = GOAL
		ENDIF
	NEXT
	RETURN GOAL
ENDIF

@TSC_NAME3
#DIMS DYNAMIC 커맨드이름
SELECTCASE CFLAG:MASTER:현재위치
	CASE 410,401
		커맨드이름 = 토끼 땅굴
	CASE 510,501,610,601,910,948
		커맨드이름 = 요괴 운수를 이용
	CASE 710,701,810,801
		커맨드이름 = 텐구 운수를 이용
	CASE 1010
		커맨드이름 = 괴안통로 이용
	CASEELSE
		커맨드이름 = 인력거를 이용
ENDSELECT
RESULTS = %커맨드이름%

@TSC_ABLE3

IF CFLAG:MASTER:현재위치 / 100 != MAIN_MAP
	SIF !GROUPMATCH(CFLAG:MASTER:현재위치,10,110,210,340,410,510,610,710,810,910,1010,1510)
    	RETURN 0
ELSEIF CFLAG:MASTER:현재위치 / 100 == MAIN_MAP
	SIF !GROUPMATCH(CFLAG:MASTER:현재위치,22,101,201,301,401,501,601,701,801,948,1301,1401)
		RETURN 0
ENDIF


IF MONEY < 2000
    RETURN 0
ENDIF
;기력 0
SIF BASE:MASTER:기력 <= 0
	RETURN 0
SIF CFLAG:우후후 == 2
	RETURN 0
;정지 중에는 불가
SIF FLAG:70
	RETURN 0
RETURN 2


